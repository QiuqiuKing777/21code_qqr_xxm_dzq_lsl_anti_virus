/*
 Navicat Premium Data Transfer

 Source Server         : nvd
 Source Server Type    : MySQL
 Source Server Version : 50735
 Source Host           : localhost:3306
 Source Schema         : nvd_database

 Target Server Type    : MySQL
 Target Server Version : 50735
 File Encoding         : 65001

 Date: 17/12/2025 09:51:28
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for affects
-- ----------------------------
DROP TABLE IF EXISTS `affects`;
CREATE TABLE `affects`  (
  `vuln_id` int(20) NOT NULL,
  `product_id` int(10) NOT NULL,
  PRIMARY KEY (`vuln_id`, `product_id`) USING BTREE,
  INDEX `fk_affects_product_id`(`product_id`) USING BTREE,
  CONSTRAINT `fk_affects_product_id` FOREIGN KEY (`product_id`) REFERENCES `product` (`product_id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_affects_vuln_id` FOREIGN KEY (`vuln_id`) REFERENCES `vuln` (`vuln_id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE = InnoDB CHARACTER SET = latin1 COLLATE = latin1_swedish_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Table structure for atk_msg
-- ----------------------------
DROP TABLE IF EXISTS `atk_msg`;
CREATE TABLE `atk_msg`  (
  `msg_id` int(11) NOT NULL AUTO_INCREMENT,
  `vuln_id` int(20) DEFAULT NULL,
  `product_id` int(10) DEFAULT NULL,
  `company_id` int(10) DEFAULT NULL,
  PRIMARY KEY (`msg_id`) USING BTREE,
  INDEX `fk_atk_msg_vuln_id`(`vuln_id`) USING BTREE,
  INDEX `fk_atk_msg_product_id`(`product_id`) USING BTREE,
  INDEX `fk_atk_msg_company_id`(`company_id`) USING BTREE,
  CONSTRAINT `fk_atk_msg_company_id` FOREIGN KEY (`company_id`) REFERENCES `companies` (`company_id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_atk_msg_product_id` FOREIGN KEY (`product_id`) REFERENCES `product` (`product_id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_atk_msg_vuln_id` FOREIGN KEY (`vuln_id`) REFERENCES `vuln` (`vuln_id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = latin1 COLLATE = latin1_swedish_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Table structure for cnvd_vuln
-- ----------------------------
DROP TABLE IF EXISTS `cnvd_vuln`;
CREATE TABLE `cnvd_vuln`  (
  `cnvd_id` varchar(20) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL,
  `cnvd_title` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `cnvd_msg` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `cnvd_creattime` timestamp(0) NOT NULL DEFAULT '1999-09-09 00:00:00',
  `cnvd_updatetime` timestamp(0) NOT NULL DEFAULT '1999-09-09 00:00:00',
  `cnvd_reference_link` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `cnvd_publisher` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `cnvd_base_sever` int(10) UNSIGNED ZEROFILL DEFAULT NULL,
  `cnvd_base_severity` int(10) UNSIGNED ZEROFILL DEFAULT NULL,
  PRIMARY KEY (`cnvd_id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = latin1 COLLATE = latin1_swedish_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of cnvd_vuln
-- ----------------------------
INSERT INTO `cnvd_vuln` VALUES ('cnvd_1', '000', 'mag_1', '1999-09-09 00:00:00', '1999-09-09 00:00:00', 'ooo', 'pbpb', 0000000000, 0000000000);
INSERT INTO `cnvd_vuln` VALUES ('cnvd_3', '111', '000', '1999-09-09 00:00:00', '1999-09-09 00:00:00', 'pb', NULL, NULL, NULL);

-- ----------------------------
-- Table structure for companies
-- ----------------------------
DROP TABLE IF EXISTS `companies`;
CREATE TABLE `companies`  (
  `company_id` int(10) NOT NULL AUTO_INCREMENT,
  `company_name` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `finance_scale` int(20) DEFAULT NULL,
  PRIMARY KEY (`company_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 5 CHARACTER SET = latin1 COLLATE = latin1_swedish_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of companies
-- ----------------------------
INSERT INTO `companies` VALUES (1, 'company_1', 1000000);
INSERT INTO `companies` VALUES (2, 'companyaaa', 100000);
INSERT INTO `companies` VALUES (3, '11177', 100000);
INSERT INTO `companies` VALUES (4, 'byuubuacwbe', 1000000);

-- ----------------------------
-- Table structure for cve_vuln
-- ----------------------------
DROP TABLE IF EXISTS `cve_vuln`;
CREATE TABLE `cve_vuln`  (
  `cve_id` varchar(20) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL,
  `cve_title` varchar(50) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `cve_msg` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `cve_creattime` timestamp(0) NOT NULL DEFAULT '1999-09-09 00:00:00' ON UPDATE CURRENT_TIMESTAMP(0),
  `cve_updatetime` timestamp(0) NOT NULL DEFAULT '1999-09-09 00:00:00',
  `cve_reference_link` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `cve_publisher` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `cve_base_sever` int(255) DEFAULT NULL,
  `cve_base_severity` int(255) DEFAULT NULL,
  PRIMARY KEY (`cve_id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = latin1 COLLATE = latin1_swedish_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Table structure for product
-- ----------------------------
DROP TABLE IF EXISTS `product`;
CREATE TABLE `product`  (
  `product_id` int(10) NOT NULL AUTO_INCREMENT,
  `product_name` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `product_version` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  PRIMARY KEY (`product_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = latin1 COLLATE = latin1_swedish_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of product
-- ----------------------------
INSERT INTO `product` VALUES (1, 'pro_1', '1.1.1');

-- ----------------------------
-- Table structure for sigma_rule
-- ----------------------------
DROP TABLE IF EXISTS `sigma_rule`;
CREATE TABLE `sigma_rule`  (
  `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT,
  `sigma_id` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'Sigma rule id（uuid）',
  `title` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '规则标题',
  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci COMMENT '规则描述',
  `rule_json` json NOT NULL COMMENT 'Sigma 原始 JSON 规则',
  `level` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '严重级别（low/medium/high）',
  `source_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '规则来源',
  `source_file` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '原始文件名',
  `sha256` char(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '规则内容 SHA256',
  `enabled` tinyint(1) NOT NULL DEFAULT 1 COMMENT '是否启用',
  `created_at` datetime(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime(0) NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP(0),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_sigma_sha256`(`sha256`) USING BTREE,
  INDEX `idx_sigma_id`(`sigma_id`) USING BTREE,
  INDEX `idx_sigma_level`(`level`) USING BTREE,
  INDEX `idx_sigma_enabled`(`enabled`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 3 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'Sigma 规则表（精简版）' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of sigma_rule
-- ----------------------------
INSERT INTO `sigma_rule` VALUES (1, '12345678-1234-5678-9101-123456789001', 'WannaCry Ransomware Detection', 'Detects WannaCry ransomware behavior including file timestamp manipulation, .wnry file creation, and executable generation', '{\"id\": \"12345678-1234-5678-9101-123456789001\", \"tags\": [\"attack.impact\", \"attack.t1486\"], \"level\": \"high\", \"title\": \"WannaCry Ransomware Detection\", \"author\": \"zzq\", \"status\": \"experimental\", \"detection\": {\"condition\": \"selection or selection2 or selection3\", \"selection\": {\"Image|endswith\": [\"\\\\1-WannaCrypt0r.exe\", \"\\\\@WanaDecryptor@.exe\"], \"TargetFileName|contains\": [\".wnry\", \"WNCRYT\"]}, \"selection2\": {\"Image|endswith\": [\"\\\\1-WannaCrypt0r.exe\"], \"TargetFileName|endswith\": [\"\\\\taskdl.exe\", \"\\\\taskse.exe\"]}, \"selection3\": {\"Image|endswith\": [\"\\\\1-WannaCrypt0r.exe\"], \"TargetFileName|contains\": [\"\\\\Start Menu\\\\Programs\\\\Startup\\\\\"]}}, \"logsource\": {\"product\": \"windows\", \"category\": \"file_event\"}, \"references\": [\"https://www.virustotal.com/\"], \"description\": \"Detects WannaCry ransomware behavior including file timestamp manipulation, .wnry file creation, and executable generation\", \"falsepositives\": [\"Legitimate security testing\", \"Backup software operations\"]}', 'high', 'manual-upload', 'sigma/rule_lab1.yml', '4caa45c0235f4f6310165b1a7a4850c428cafe2fc024323fe084997bb8573c70', 1, '2025-12-12 23:46:18', '2025-12-12 23:46:18');
INSERT INTO `sigma_rule` VALUES (2, '8a7c3d2b-1e4a-4b8f-9a2c-3f1234567890', 'Suspicious Process - Heiren Taiguan Malware', 'Detects execution of a known malicious sample \"2-hrtg.exe\" with Chinese description related to \"黑人抬棺病毒\"', '{\"id\": \"8a7c3d2b-1e4a-4b8f-9a2c-3f1234567890\", \"date\": \"2025/11/12\", \"tags\": [\"attack.execution\", \"attack.t1059\"], \"level\": \"high\", \"title\": \"Suspicious Process - Heiren Taiguan Malware\", \"author\": \"Generated from Sysmon logs\", \"status\": \"experimental\", \"detection\": {\"condition\": \"selection\", \"selection\": {\"Image|endswith\": \"\\\\2-hrtg.exe\", \"Description|contains\": \"黑人抬棺病毒\"}}, \"logsource\": {\"product\": \"windows\", \"category\": \"process_creation\"}, \"description\": \"Detects execution of a known malicious sample \\\"2-hrtg.exe\\\" with Chinese description related to \\\"黑人抬棺病毒\\\"\", \"falsepositives\": [\"Legitimate use in malware analysis environment\"]}', 'high', 'manual-upload', 'sigma/rule_lab2.yml', 'b88d5d341bdcf2afb32b579144dfe9551a4cbbcc358ec8136a348ec624cb3ffc', 1, '2025-12-12 23:46:18', '2025-12-12 23:46:18');

-- ----------------------------
-- Table structure for used
-- ----------------------------
DROP TABLE IF EXISTS `used`;
CREATE TABLE `used`  (
  `product_id` int(10) NOT NULL,
  `company_id` int(10) NOT NULL,
  PRIMARY KEY (`product_id`, `company_id`) USING BTREE,
  INDEX `fk_used_company_id`(`company_id`) USING BTREE,
  CONSTRAINT `fk_used_company_id` FOREIGN KEY (`company_id`) REFERENCES `companies` (`company_id`) ON DELETE CASCADE ON UPDATE NO ACTION,
  CONSTRAINT `fk_used_product_id` FOREIGN KEY (`product_id`) REFERENCES `product` (`product_id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Table structure for vuln
-- ----------------------------
DROP TABLE IF EXISTS `vuln`;
CREATE TABLE `vuln`  (
  `vuln_id` int(20) NOT NULL AUTO_INCREMENT,
  `vuln_cve_id` varchar(20) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  `vuln_cnvd_id` varchar(20) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  PRIMARY KEY (`vuln_id`) USING BTREE,
  INDEX `fk_vuln_cve_id`(`vuln_cve_id`) USING BTREE,
  INDEX `fk_vuln_cnvd_id`(`vuln_cnvd_id`) USING BTREE,
  CONSTRAINT `fk_vuln_cve_id` FOREIGN KEY (`vuln_cve_id`) REFERENCES `cve_vuln` (`cve_id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE = InnoDB AUTO_INCREMENT = 18 CHARACTER SET = latin1 COLLATE = latin1_swedish_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of vuln
-- ----------------------------
INSERT INTO `vuln` VALUES (15, NULL, 'cnvd_1');
INSERT INTO `vuln` VALUES (17, NULL, 'cnvd_3');

-- ----------------------------
-- Table structure for yara_rule
-- ----------------------------
DROP TABLE IF EXISTS `yara_rule`;
CREATE TABLE `yara_rule`  (
  `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT,
  `source_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '规则来源（manual-upload / zip / repo）',
  `source_file` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '原始规则文件路径（zip 内相对路径或文件名）',
  `compiled_rule` longblob NOT NULL COMMENT '预编译后的 YARA 二进制规则（python-yara save 产物）',
  `compiled_sha256` char(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '预编译二进制 SHA256（用于去重）',
  `compiled_at` datetime(0) NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '编译时间',
  `enabled` tinyint(1) NOT NULL DEFAULT 1 COMMENT '是否启用（扫描时是否加载）',
  `created_at` datetime(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime(0) NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP(0),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_yara_compiled_sha256`(`compiled_sha256`) USING BTREE,
  INDEX `idx_yara_rule_enabled`(`enabled`) USING BTREE,
  INDEX `idx_yara_rule_source_file`(`source_file`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 3 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'YARA 预编译规则表（文件级）' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of yara_rule
-- ----------------------------
INSERT INTO `yara_rule` VALUES (1, 'manual-upload', 'rightY/lab1.yar', 0x59415241150C960000000000000010000000A60000000000000050010000F60100000000000000000000F601000000000000980400008E0600000000000018000000A606000000000000AD010000530800000000000055020000A80A00000000000000000000A80A00000000000000080000A81200000000000000080000A81A00000000000048030000F01D0000000000000C00000005000000000000000000000000000000000000000600000006000000000000000500000008000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF030000000000000000000000000000000000000003000000030000000000000005000000A6000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF030000005001000000000000000000000000000004000000010000000000000005000000C9000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF03000000F8010000000000000000000000000000030000000300000000000000050000000E010000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF03000000D80200000000000000000000000000000500000005000000000000000500000031010000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0300000080030000000000000000000004000000FAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFA0906000000000000FFDABAFADABAFAFF000000000C000000050000001A000000FFFFFFFFFFFFFFFF000000000000000005000000110000000906000001000000FFDABAFADABAFAFF000000000C0000000500000030000000FFFFFFFFFFFFFFFF000000000000000005000000270000000906000002000000FFDABAFADABAFAFF00000000200000000500000046000000FFFFFFFFFFFFFFFF0000000000000000050000003D0000000906000003000000FFDABAFADABAFAFF000000000D0000000500000070000000FFFFFFFFFFFFFFFF000000000000000005000000670000000906000004000000FFDABAFADABAFAFF000000000C0000000500000087000000FFFFFFFFFFFFFFFF0000000000000000050000007E0000000916000005000000FFDABAFADABAFAFF0000000008000000050000009D000000FFFFFFFFFFFFFFFF000000000000000005000000940000000906000006000000FFDABAFADABAFAFF010000000500000005000000AF000000FFFFFFFFFFFFFFFF00000000000000000500000011000000090E000007000000FFDABAFADABAFAFF010000000400000005000000B5000000FFFFFFFFFFFFFFFF000000000000000005000000270000000916000008000000FFDABAFADABAFAFF010000000E00000005000000BA000000FFFFFFFFFFFFFFFF0000000000000000050000003D0000000906000009000000FFDABAFADABAFAFF020000001000000005000000D2000000FFFFFFFFFFFFFFFF00000000000000000500000011000000090600000A000000FFDABAFADABAFAFF020000000D00000005000000E3000000FFFFFFFFFFFFFFFF00000000000000000500000027000000090600000B000000FFDABAFADABAFAFF020000000E00000005000000F1000000FFFFFFFFFFFFFFFF0000000000000000050000003D000000091600000C000000FFDABAFADABAFAFF020000000D0000000500000000010000FFFFFFFFFFFFFFFF00000000000000000500000067000000090600000D000000FFDABAFADABAFAFF03000000080000000500000017010000FFFFFFFFFFFFFFFF00000000000000000500000011000000090600000E000000FFDABAFADABAFAFF03000000080000000500000020010000FFFFFFFFFFFFFFFF00000000000000000500000027000000091600000F000000FFDABAFADABAFAFF03000000070000000500000029010000FFFFFFFFFFFFFFFF0000000000000000050000003D0000000906000010000000FFDABAFADABAFAFF040000000C000000050000003A010000FFFFFFFFFFFFFFFF000000000000000005000000110000000906000011000000FFDABAFADABAFAFF040000000C0000000500000047010000FFFFFFFFFFFFFFFF000000000000000005000000270000000906000012000000FFDABAFADABAFAFF040000000E0000000500000054010000FFFFFFFFFFFFFFFF0000000000000000050000003D0000000906000013000000FFDABAFADABAFAFF04000000150000000500000063010000FFFFFFFFFFFFFFFF000000000000000005000000670000000916000014000000FFDABAFADABAFAFF04000000330000000500000079010000FFFFFFFFFFFFFFFF0000000000000000050000007E00000000000000FAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFA64656661756C74006C616231316578650024737472696E6731004C616230312D30312E646C6C0024737472696E6732006B65726E653133322E646C6C0024737472696E673300433A5C77696E646F77735C73797374656D33325C6B65726E653133322E646C6C0024737472696E67340046696E64466972737446696C650024737472696E67350046696E644E65787446696C650024737472696E673600436F707946696C65006C61623131646C6C00736C65657000657865630043726561746550726F6365737341006C6162313265786500496E7465726E65744F70656E55726C4100496E7465726E65744F70656E41004F70656E53434D616E6167657241004144564141504933322E646C6C006C61623133657865006F6C6533322E7664004F4C454155544C41005F6765746D6173006C61623134657865004C6F61645265736F757263650046696E645265736F757263650053697A656F665265736F75726365005C73797374656D33325C777570646D67722E65786500687474703A2F2F7777772E70726163746963616C6D616C77617265616E616C797369732E636F6D2F757064617465722E657865001C940000000000000025410000A000662F0D0000003F00F4404D5A64012F0E0000003F3CF4F440504564012F100000000D030000000000000016012F100000000D030000003800000016012F100000000D030000007000000016012F100000000D03000000A800000016012F100000000D03000000E000000016012F100000000D030000001801000016011D00000000000000001C640000000100000025410000A000662F0D0000003F00F4404D5A64012F0E0000003F3CF4F440504564012F100000000D030000005001000016012F100000000D030000008801000016012F100000000D03000000C001000016011D01000000000000001C740000000200000025410000A000662F0D0000003F00F4404D5A64012F0E0000003F3CF4F440504564012F400000000D03000000F80100001631100000000D0300000030020000160231100000000D0300000068020000160231100000000D03000000A00200001602011D02000000000000001C640000000300000025410000A000662F0D0000003F00F4404D5A64012F0E0000003F3CF4F440504564012F100000000D03000000D802000016012F100000000D030000001003000016012F100000000D030000004803000016011D03000000000000001C840000000400000025410000A000662F0D0000003F00F4404D5A64012F0E0000003F3CF4F440504564012F100000000D030000008003000016012F100000000D03000000B803000016012F100000000D03000000F003000016012F100000000D030000002804000016012F100000000D030000006004000016011D0400000000000000FF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000C000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000A0000000A000000000000000A00000000000000020000000A000000000000000A000000000000000000002E1A00000000000000160000000000003216000000000000000A000000000000341E00000002000000000000343000000000000000000000000A000034260000313A0000343C0000000000000000000033400000000A00004418000000000000334E0000470E0000000000003B4400004A12000033540000000000004D0C0000000000003260000050100000335E00003062000000000000540600004D2400002F76000000000000464A00002F800000000000000000000000000000000000002F9C00002FA60000600800000000000000000000000000000000000000000000660A00004270000000000000000000000000000000000000682800006A2000006E04000000000000000000006A320000711C0000624200007414000075020000702200006D3600006F2E0000712A00006646000066480000702C00005D6600007934000073380000664C00006652000066560000000000000000000066680000656A0000715800006F5A000000000000648200007B3E000075500000628A000066780000668600000000000000000000659800006F74000000000000000000000000000000000000756E0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007A90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000150000000000000014000000130000001100000000000000100000000F000000000000000C0000000D0000000B0000000000000000000000000000000E0000000800000000000000070000000000000009000000000000000000000006000000000000000000000000000000120000000000000003000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF09000000000000000300000038000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF09000000000000000300000070000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0A000000280000001D0000000000000003000000A8000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF040000000000000003000000E0000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0A0000007800000004000000000000000300000018010000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF04000000000000000300000050010000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF04000000000000000300000088010000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF040000000000000003000000C0010000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF040000000000000003000000F8010000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF04000000000000000300000030020000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0A0000006801000004000000000000000300000068020000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF040000000000000003000000A0020000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0A0000000000000003000000D8020000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF06000000000000000300000010030000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF04000000000000000300000048030000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF04000000000000000300000080030000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF040000000000000003000000B8030000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0A000000A0000000040000000000000003000000F0030000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF04000000000000000300000028040000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0A000000000000000300000060040000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF06000000000000000500000015000000010000000000000000000000010000001000000001000000180000000100000028000000010000002000000001000000300000000300000030000000030000001800000003000000200000000A000000000000000A000000080000000A000000100000000A000000180000000300000068000000030000005000000003000000580000000A000000280000000A000000300000000A000000380000000A0000004000000003000000A0000000030000008800000003000000900000000A000000500000000A000000580000000A000000600000000A0000006800000003000000D800000003000000C000000003000000C80000000A000000780000000A000000800000000A000000880000000A00000090000000030000001001000003000000F800000003000000000100000A000000A00000000A000000A80000000A000000B00000000A000000B80000000300000048010000030000003001000003000000380100000A000000C80000000A000000D00000000A000000D80000000A000000E0000000060000003100000006000000410000000600000051000000060000006100000006000000710000000600000081000000010000004800000001000000500000000100000060000000010000005800000001000000680000000300000080010000030000006801000003000000700100000A000000F00000000A000000F80000000A000000000100000A0000000801000003000000B801000003000000A001000003000000A80100000A000000180100000A000000200100000A000000280100000A0000003001000003000000F001000003000000D801000003000000E00100000A000000400100000A000000480100000A000000500100000A0000005801000006000000C500000006000000D500000006000000E5000000010000008000000001000000880000000100000098000000010000009000000001000000A00000000300000028020000030000001002000003000000180200000A000000680100000A000000700100000A000000780100000A000000800100000300000060020000030000004802000003000000500200000A000000900100000A000000980100000A000000A00100000A000000A80100000300000098020000030000008002000003000000880200000A000000B80100000A000000C00100000A000000C80100000A000000D001000003000000D002000003000000B802000003000000C00200000A000000E00100000A000000E80100000A000000F00100000A000000F8010000060000002901000006000000380100000600000048010000060000005801000001000000B800000001000000C000000001000000D000000001000000C800000001000000D8000000030000000803000003000000F002000003000000F80200000A000000080200000A000000100200000A000000180200000A000000200200000300000040030000030000002803000003000000300300000A000000300200000A000000380200000A000000400200000A000000480200000300000078030000030000006003000003000000680300000A000000580200000A000000600200000A000000680200000A00000070020000060000009D01000006000000AD01000006000000BD01000001000000F000000001000000F800000001000000080100000100000000010000010000001001000003000000B0030000030000009803000003000000A00300000A000000800200000A000000880200000A000000900200000A0000009802000003000000E803000003000000D003000003000000D80300000A000000A80200000A000000B00200000A000000B80200000A000000C00200000300000020040000030000000804000003000000100400000A000000D00200000A000000D80200000A000000E00200000A000000E80200000300000058040000030000004004000003000000480400000A000000F80200000A000000000300000A000000080300000A000000100300000300000090040000030000007804000003000000800400000A000000200300000A000000280300000A000000300300000A0000003803000006000000010200000600000011020000060000002102000006000000310200000600000041020000, 'b57c87d801905ec9b59ec6ad054777dd5e039daaaa36eb925c0c54ed5dd093ac', '2025-12-17 09:14:56', 1, '2025-12-17 09:14:56', '2025-12-17 09:14:56');
INSERT INTO `yara_rule` VALUES (2, 'manual-upload', 'rightY/lab11dll.yar', 0x59415241150C960000000000000010000000A600000000000000700000001601000000000000000000001601000000000000A8000000BE0100000000000018000000D601000000000000460000001C0200000000000065000000810200000000000000000000810200000000000000080000810A00000000000000080000811200000000000078000000F9120000000000000C00000005000000000000000000000000000000000000000300000003000000000000000500000008000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0300000000000000000000000000000004000000FAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFA0906000000000000FFDABAFADABAFAFF0000000005000000050000001A000000FFFFFFFFFFFFFFFF00000000000000000500000011000000090E000001000000FFDABAFADABAFAFF00000000040000000500000029000000FFFFFFFFFFFFFFFF000000000000000005000000200000000916000002000000FFDABAFADABAFAFF000000000E0000000500000037000000FFFFFFFFFFFFFFFF0000000000000000050000002E00000000000000FAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFA64656661756C74006C61623131646C6C0024737472696E673100736C6565700024737472696E673200657865630024737472696E67330043726561746550726F6365737341001C640000000000000025410000A000662F0D0000003F00F4404D5A64012F0E0000003F3CF4F440504564012F100000000D030000000000000016012F100000000D030000003800000016012F100000000D030000007000000016011D0000000000000000FF00000000000000000000000000000000000000000000000000000000000200000002000000020000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000066020000000000000000000062140000660E000066120000661000006416000066180000000000006D0C0000000000000000000000000000740600007308000000000000000000000000000000000000790A0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000200000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF04000000000000000300000038000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF04000000000000000300000070000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF04000000000000000100000003000000010000000000000000000000010000001000000001000000180000000100000028000000010000002000000001000000300000000300000030000000030000001800000003000000200000000A000000000000000A000000080000000A000000100000000A000000180000000300000068000000030000005000000003000000580000000A000000280000000A000000300000000A000000380000000A0000004000000003000000A0000000030000008800000003000000900000000A000000500000000A000000580000000A000000600000000A00000068000000060000003100000006000000410000000600000051000000, '5589308dec2da862d19f0e81a1767602a7c5a55072a9c370de8ce43348b169fd', '2025-12-17 09:14:56', 1, '2025-12-17 09:14:56', '2025-12-17 09:14:56');

-- ----------------------------
-- Table structure for yara_uncompiled
-- ----------------------------
DROP TABLE IF EXISTS `yara_uncompiled`;
CREATE TABLE `yara_uncompiled`  (
  `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT,
  `rule_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'YARA rule 名称',
  `rule_text` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'YARA 规则全文',
  `source_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '规则来源',
  `source_file` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '原始文件名（zip 内路径）',
  `sha256` char(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'rule_text 的 SHA256（规则级去重）',
  `compiled_rule_id` bigint(20) UNSIGNED DEFAULT NULL COMMENT '指向 yara_rule.id（可为空，表示尚未编译）',
  `created_at` datetime(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime(0) NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP(0),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_yara_uncompiled_sha256`(`sha256`) USING BTREE,
  INDEX `idx_yara_uncompiled_rule_name`(`rule_name`) USING BTREE,
  INDEX `idx_yara_uncompiled_compiled_rule_id`(`compiled_rule_id`) USING BTREE,
  CONSTRAINT `fk_yara_uncompiled_compiled` FOREIGN KEY (`compiled_rule_id`) REFERENCES `yara_rule` (`id`) ON DELETE SET NULL ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 7 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'YARA 原始规则表（未编译）' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of yara_uncompiled
-- ----------------------------
INSERT INTO `yara_uncompiled` VALUES (1, 'lab11exe', 'rule lab11exe\n{\nstrings:\n	$string1 = \"Lab01-01.dll\"\n	$string2 = \"kerne132.dll\"\n	$string3 = \"C:\\\\windows\\\\system32\\\\kerne132.dll\"\n	$string4 = \"FindFirstFile\"\n	$string5 = \"FindNextFile\"\n	$string6 = \"CopyFile\"\ncondition:\n	filesize < 10MB and uint16(0) == 0x5A4D and uint16(uint16(0x3C)) == 0x00004550 and $string1 and $string2 and $string3 and $string4 and $string5 and $string6\n}', 'manual-upload', 'rightY/lab1.yar', '22476c778d5730c57fa94c66599810592b0e1718ee46f3c0fb1c7396ab4b8b26', 1, '2025-12-17 09:14:56', '2025-12-17 09:14:56');
INSERT INTO `yara_uncompiled` VALUES (2, 'lab11dll', 'rule lab11dll\n{\nstrings:\n	$string1 = \"sleep\"\n	$string2 = \"exec\" \n	$string3 = \"CreateProcessA\"\ncondition:\n	filesize < 10MB and uint16(0) == 0x5A4D and uint16(uint16(0x3C)) == 0x00004550 and $string1 and $string2 and $string3\n}', 'manual-upload', 'rightY/lab1.yar', 'eb59d83cb3fd46436f709c1d41a2982f14c9b5a1215c8d3aa422b77a48452db9', 1, '2025-12-17 09:14:56', '2025-12-17 09:14:56');
INSERT INTO `yara_uncompiled` VALUES (3, 'lab12exe', 'rule lab12exe\n{\nstrings:\n	$string1 = \"InternetOpenUrlA\"\n	$string2 = \"InternetOpenA\" \n	$string3 =\"OpenSCManagerA\"\n	$string4 = \"ADVAAPI32.dll\"\ncondition:\n	filesize < 10MB and uint16(0) == 0x5A4D and uint16(uint16(0x3C)) == 0x00004550 and ( $string1 or $string2 or $string3 or $string4)\n}', 'manual-upload', 'rightY/lab1.yar', 'bbae1d32d1d6159d28eb278f4219b8bb5d92148b51501ffb89beec5298f3e4db', 1, '2025-12-17 09:14:56', '2025-12-17 09:14:56');
INSERT INTO `yara_uncompiled` VALUES (4, 'lab13exe', 'rule lab13exe\n{\nstrings:\n	$string1 = \"ole32.vd\"\n	$string2 = \"OLEAUTLA\" \n	$string3 = \"_getmas\"\ncondition:\n	filesize < 10MB and uint16(0) == 0x5A4D and uint16(uint16(0x3C)) == 0x00004550 and $string1 and $string2 and $string3\n}', 'manual-upload', 'rightY/lab1.yar', '8294d3f6064e856b6043c658287535d0c96899c8fc3ba2bbdfc69f6591e6e854', 1, '2025-12-17 09:14:56', '2025-12-17 09:14:56');
INSERT INTO `yara_uncompiled` VALUES (5, 'lab14exe', 'rule lab14exe\n{\nstrings:\n	$string1 = \"LoadResource\"\n	$string2 = \"FindResource\" \n	$string3 = \"SizeofResource\"\n	$string4 = \"\\\\system32\\\\wupdmgr.exe\"\n	$string5 = \"http://www.practicalmalwareanalysis.com/updater.exe\"\ncondition:\n	filesize < 10MB and uint16(0) == 0x5A4D and uint16(uint16(0x3C)) == 0x00004550 and $string1 and $string2 and $string3 and $string4 and $string5\n}', 'manual-upload', 'rightY/lab1.yar', '0bde5d0d480689e4fb122c977f074f6d9656840073487bfda3c56a1ae7dda73b', 1, '2025-12-17 09:14:56', '2025-12-17 09:14:56');

-- ----------------------------
-- View structure for vuln_details
-- ----------------------------
DROP VIEW IF EXISTS `vuln_details`;
CREATE ALGORITHM = UNDEFINED DEFINER = `root`@`localhost` SQL SECURITY DEFINER VIEW `vuln_details` AS select `v`.`vuln_id` AS `vuln_id`,`v`.`vuln_cnvd_id` AS `vuln_cnvd_id`,`v`.`vuln_cve_id` AS `vuln_cve_id`,`cnvd`.`cnvd_id` AS `cnvd_id`,`cnvd`.`cnvd_title` AS `cnvd_title`,`cnvd`.`cnvd_msg` AS `cnvd_msg`,`cnvd`.`cnvd_creattime` AS `cnvd_creattime`,`cnvd`.`cnvd_updatetime` AS `cnvd_updatetime`,`cnvd`.`cnvd_reference_link` AS `cnvd_reference_link`,`cnvd`.`cnvd_publisher` AS `cnvd_publisher`,`cnvd`.`cnvd_base_sever` AS `cnvd_base_sever`,`cnvd`.`cnvd_base_severity` AS `cnvd_base_severity`,`cve`.`cve_id` AS `cve_id`,`cve`.`cve_title` AS `cve_title`,`cve`.`cve_msg` AS `cve_msg`,`cve`.`cve_creattime` AS `cve_creattime`,`cve`.`cve_updatetime` AS `cve_updatetime`,`cve`.`cve_reference_link` AS `cve_reference_link`,`cve`.`cve_publisher` AS `cve_publisher`,`cve`.`cve_base_sever` AS `cve_base_sever`,`cve`.`cve_base_severity` AS `cve_base_severity` from ((`vuln` `v` left join `cnvd_vuln` `cnvd` on((`v`.`vuln_cnvd_id` = `cnvd`.`cnvd_id`))) left join `cve_vuln` `cve` on((`v`.`vuln_cve_id` = `cve`.`cve_id`)));

-- ----------------------------
-- Procedure structure for update_cnvd_vuln
-- ----------------------------
DROP PROCEDURE IF EXISTS `update_cnvd_vuln`;
delimiter ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `update_cnvd_vuln`(IN p_old_cnvd_id VARCHAR(20), IN p_data JSON)
BEGIN
    -- 定义变量
    DECLARE v_new_cnvd_id VARCHAR(20);
    DECLARE v_cnvd_title VARCHAR(255);
    DECLARE v_cnvd_msg TEXT;
    DECLARE v_cnvd_creattime DATETIME;
    DECLARE v_cnvd_updatetime DATETIME;
    DECLARE v_cnvd_reference_link VARCHAR(255);
    DECLARE v_cnvd_publisher VARCHAR(255);
    DECLARE v_cnvd_base_sever INT;
    DECLARE v_cnvd_base_severity INT;
    
    -- 提取新的cnvd_id（如果存在于JSON中）
    SET v_new_cnvd_id = NULLIF(JSON_UNQUOTE(JSON_EXTRACT(p_data, '$.cnvd_id')), '');
    
    -- 检查是否尝试修改为"cnvd_1"
    IF v_new_cnvd_id IS NOT NULL AND LOWER(v_new_cnvd_id) = 'cnvd_1' THEN
        SIGNAL SQLSTATE '45000' 
        SET MESSAGE_TEXT = 'Cannot update cnvd_id to "cnvd_1" as it is a restricted value';
    END IF;
    
    -- 提取其他字段
    SET v_cnvd_title = NULLIF(JSON_UNQUOTE(JSON_EXTRACT(p_data, '$.cnvd_title')), '');
    SET v_cnvd_msg = NULLIF(JSON_UNQUOTE(JSON_EXTRACT(p_data, '$.cnvd_msg')), '');
    
    -- 处理日期时间字段
    BEGIN
        DECLARE temp_creattime VARCHAR(255);
        DECLARE temp_updatetime VARCHAR(255);
        
        SET temp_creattime = NULLIF(JSON_UNQUOTE(JSON_EXTRACT(p_data, '$.cnvd_creattime')), '');
        SET temp_updatetime = NULLIF(JSON_UNQUOTE(JSON_EXTRACT(p_data, '$.cnvd_updatetime')), '');
        
        IF temp_creattime IS NOT NULL THEN
            SET v_cnvd_creattime = STR_TO_DATE(temp_creattime, '%Y-%m-%d %H:%i:%s');
        END IF;
        
        IF temp_updatetime IS NOT NULL THEN
            SET v_cnvd_updatetime = STR_TO_DATE(temp_updatetime, '%Y-%m-%d %H:%i:%s');
        END IF;
    END;
    
    SET v_cnvd_reference_link = NULLIF(JSON_UNQUOTE(JSON_EXTRACT(p_data, '$.cnvd_reference_link')), '');
    SET v_cnvd_publisher = NULLIF(JSON_UNQUOTE(JSON_EXTRACT(p_data, '$.cnvd_publisher')), '');
    
    -- 处理数值字段
    BEGIN
        DECLARE temp_sever VARCHAR(20);
        DECLARE temp_severity VARCHAR(20);
        
        SET temp_sever = NULLIF(JSON_UNQUOTE(JSON_EXTRACT(p_data, '$.cnvd_base_sever')), '');
        SET temp_severity = NULLIF(JSON_UNQUOTE(JSON_EXTRACT(p_data, '$.cnvd_base_severity')), '');
        
        IF temp_sever IS NOT NULL THEN
            SET v_cnvd_base_sever = CAST(temp_sever AS UNSIGNED);
        END IF;
        
        IF temp_severity IS NOT NULL THEN
            SET v_cnvd_base_severity = CAST(temp_severity AS UNSIGNED);
        END IF;
    END;
    
    -- 开始事务
    START TRANSACTION;
    
    -- 如果提供了新的cnvd_id，则先更新vuln表中的相关记录
    IF v_new_cnvd_id IS NOT NULL AND v_new_cnvd_id <> p_old_cnvd_id THEN
        UPDATE vuln 
        SET vuln_cnvd_id = v_new_cnvd_id 
        WHERE vuln_cnvd_id = p_old_cnvd_id;
    END IF;
    
    -- 更新cnvd_vuln表
    UPDATE cnvd_vuln
    SET
        cnvd_id = COALESCE(v_new_cnvd_id, p_old_cnvd_id),
        cnvd_title = COALESCE(v_cnvd_title, cnvd_title),
        cnvd_msg = COALESCE(v_cnvd_msg, cnvd_msg),
        cnvd_creattime = COALESCE(v_cnvd_creattime, cnvd_creattime),
        cnvd_updatetime = COALESCE(v_cnvd_updatetime, cnvd_updatetime),
        cnvd_reference_link = COALESCE(v_cnvd_reference_link, cnvd_reference_link),
        cnvd_publisher = COALESCE(v_cnvd_publisher, cnvd_publisher),
        cnvd_base_sever = COALESCE(v_cnvd_base_sever, cnvd_base_sever),
        cnvd_base_severity = COALESCE(v_cnvd_base_severity, cnvd_base_severity)
    WHERE cnvd_id = p_old_cnvd_id;
    
    -- 提交事务
    COMMIT;
    
    -- 返回受影响的行数
    SELECT ROW_COUNT() AS affected_rows;
END
;;
delimiter ;

-- ----------------------------
-- Triggers structure for table cnvd_vuln
-- ----------------------------
DROP TRIGGER IF EXISTS `after_cnvd_ins_trigger`;
delimiter ;;
CREATE DEFINER = `root`@`localhost` TRIGGER `after_cnvd_ins_trigger` AFTER INSERT ON `cnvd_vuln` FOR EACH ROW BEGIN
    INSERT INTO vuln (vuln_cnvd_id)
    VALUES (NEW.cnvd_id);
END
;;
delimiter ;

-- ----------------------------
-- Triggers structure for table companies
-- ----------------------------
DROP TRIGGER IF EXISTS `before_insert_companies`;
delimiter ;;
CREATE DEFINER = `root`@`localhost` TRIGGER `before_insert_companies` BEFORE INSERT ON `companies` FOR EACH ROW BEGIN
    IF NEW.finance_scale < 1000 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Cannot insert company with finance_scale less than 1000';
    END IF;
END
;;
delimiter ;

-- ----------------------------
-- Triggers structure for table cve_vuln
-- ----------------------------
DROP TRIGGER IF EXISTS `after_cve_ins_trigger`;
delimiter ;;
CREATE DEFINER = `root`@`localhost` TRIGGER `after_cve_ins_trigger` AFTER INSERT ON `cve_vuln` FOR EACH ROW BEGIN
    INSERT INTO vuln (vuln_cve_id, vuln_cnvd_id)
    VALUES (NEW.cve_id, NULL);
END
;;
delimiter ;

SET FOREIGN_KEY_CHECKS = 1;
